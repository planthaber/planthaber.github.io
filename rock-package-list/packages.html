<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rock Package List</title>

<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="JSON.js"></script>



<script>

function addTableLine(target, pkg_name, pkg_homepage, pkg_wiki, pkg_ghpage, pkg_issues, pkg_contrib){
	var table = document.getElementById(target);
	var tr = document.createElement('tr');
	var name = document.createElement('td');
	var links1 = document.createElement('td');
	var links2 = document.createElement('td');
	var links3 = document.createElement('td');
	var issues = document.createElement('td');
	var contrib = document.createElement('td');
	
	tr.appendChild(name);
	tr.appendChild(links1);
	tr.appendChild(links2);
	tr.appendChild(links3);
	tr.appendChild(issues);
	tr.appendChild(contrib);
	
	name.innerHTML=pkg_name;
	
	var hp = document.createElement('a');
	var wiki = document.createElement('a');
	var ghpage = document.createElement('a');
	
	links1.appendChild(hp);
	links2.appendChild(wiki);
	links3.appendChild(ghpage);
	
	if (pkg_homepage != ""){
		hp.setAttribute("href",pkg_homepage);
		hp.innerHTML = "HP"
	}
	if (pkg_wiki != ""){
		wiki.setAttribute("href",pkg_wiki);
		wiki.innerHTML = "Wiki"
	}
	if (pkg_ghpage != ""){
		ghpage.setAttribute("href",pkg_ghpage);
		ghpage.innerHTML = "gh-page"
	}
		
	var issues_link = document.createElement('a');
	issues_link.setAttribute("href","https://github.com/"+target+"/"+pkg_name+"/issues");
	issues_link.innerHTML = pkg_issues;
	issues.appendChild(issues_link);
	
	var contrib_target_name = target+pkg_name+"collab";
	contrib.setAttribute("id",contrib_target_name);
	//load contribs from GH via api has too many requests (60 per hout allowed),
	//loading the contribs whould reach the limit on the first load of the packages 
	//getContrib(pkg_contrib,contrib_target_name);
	var link = document.createElement('a');
	link.setAttribute("href","https://github.com/"+target+"/"+pkg_name+"/graphs/contributors");
	link.innerHTML="Link";
	contrib.appendChild(link);
	
	//finally add the table line
	table.appendChild(tr);
	

	
	
}

function addEntry(package_entry, target){
	
	var wiki = "";
	if (package_entry.has_wiki){
		wiki = "https://github.com/" + target + "/" + package_entry.name + "/wiki";
	}
	var ghpage = "";
	if (package_entry.has_pages){
		ghpage = "http://" + target + ".github.io/" + package_entry.name;
	}
	
	addTableLine(target,package_entry.name,package_entry.homepage,wiki,ghpage,package_entry.open_issues_count,package_entry.contributors_url);

}

function loadOrganization(name){
	var target = document.getElementById("packagelists");
	var org = document.createElement("div");
	var table = document.createElement("table");
	table.setAttribute("id",name);
	var headline = document.createElement("h2");
	headline.innerHTML = name;

	org.appendChild(headline);
	org.appendChild(table);
	
	
	target.appendChild(org);
 	JSON.load("https://api.github.com/users/" + name + "/repos?page=1&per_page=0", function(result){
 		//addTableLine(name,"package", "homepage", "wiki", "gh-page", "collaborators");
		var tr = document.createElement('tr');
		table.appendChild(tr);
		tr.innerHTML = "<td><b>Name</b></td><td><b>Homepage</b></td><td><b>Wiki</b></td><td><b>GH Page</b></td><td><b>Issues</b></td><td><b>Contributors</b></td>"

		result.forEach(function(elem){
			//console.log(elem);
			addEntry(elem,name);
		});
	});
}

function init(){
	loadOrganization("rock-core");
	loadOrganization("rock-planning");
	loadOrganization("rock-simulation");
	
}

</script>

</head>
<body onload="init()">

<div id="packagelists"></div>

</body>
</html>
